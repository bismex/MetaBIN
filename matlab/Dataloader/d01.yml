
INPUT:
  SIZE_TRAIN: [256, 128] # vehicle: [256,256]
  SIZE_TEST: [256, 128] # vehicle: [256,256]
  DO_AUTOAUG: False
  CJ:
    ENABLED: False
  DO_AUGMIX: False
  RPT:
    ENABLED: False #
  REA:
    ENABLED: False #

META:
  BOTTLENECK:
    DO_IT: False #
    REDUCTION_DIM: 1024 
    NORM: True
  DATA:
    NAMES: "" # 'VeRi_keypoint_each_4', 'DG'
    NUM_DOMAINS: 5
    LOADER_FLAG: 'same' # "individual"(3), "diff"(2), "same"(1)
    LOADER_FLAG_SAME_DATA: True
    MTRAIN_MINI_BATCH: 80
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 80
    MTEST_NUM_INSTANCE: 4

  REGULARIZER:
    LR_FACTOR: 10.0
  MODEL:
    LR_FACTOR: 1.0
    SPLIT_LAYER: ('',) # classifier
    META_COMPUTE_LAYER: ('gate',) # domain
    META_UPDATE_LAYER: ('gate',) # reg
  SOLVER:
    INIT:
      INNER_LOOP: 1 # meta-init
      OUTER_LOOP: 3 # meta-train/test/optimization
    MTRAIN:
      INNER_LOOP: 1 # meta-train inner loop
      INNER_LOOP_TYPE: 'diff' # same / diff-> unroll same data?
      NUM_DOMAIN: 3
      SECOND_ORDER: True # second order
      FREEZE_GRAD_META: True # freeze gradient_requires w/o update and conpute parameters
    MTEST:
      ONLY_ONE_DOMAIN: False
    FINAL:
      SAVE_META_PARAM: False
      MAX_ITER: 20
      STEPS: [10,15]
      WARMUP_ITERS: 5
      INITIALIZE_CONV_STATE_META: 'pretrained'
      INITIALIZE_CONV_STATE_ORI: 'pretrained'
      INITIALIZE_CONV: True
      INITIALIZE_FC: True
      WEIGHT_LOADER: None
      WEIGHT_FOLDER: None
    BIN_GATE:
      LR_FACTOR: 100.0
    DETAIL_MODE: False
    WRITE_PERIOD: 1
    TRAIN_ORIGINAL: True
    MANUAL_ZERO_GRAD: True # optimizer.zero_grad & weight.grad = None
    SYNC: True
  LOSS:
    COMBINED: True
    META_REG_WEIGHT: 0.001
    ORI_REG_WEIGHT: 0.01
    INIT_NAME: ("CrossEntropyLoss",)
    MTRAIN_NAME: ("CrossEntropyLoss",)
    MTEST_NAME: ("CrossEntropyLoss",)


MODEL:
  META_ARCHITECTURE: "Metalearning"
  BACKBONE:
    WITH_IBN: False  # 'pretrained/resnet50_ibn_a.pth'
    WITH_NL: False
    PRETRAIN: True
    PRETRAIN_PATH: ''
    NORM: "BN"
  HEADS:
    NAME: "MetalearningHead"
    POOL_LAYER: "fastavgpool" # 'fastavgpool', 'avgpool', 'maxpool', 'gempoolP', 'gempool', 'avgmaxpool', 'clipavgpool', 'identity'
    BT_NORM: "BN"
    NORM: "BN"
    CLS_LAYER: "linear" # 'linear', 'arcSoftmax(x)', 'circleSoftmax', 'amSoftmax(poor)'
    NECK_FEAT: "before"  # before, after
  LOSSES:
    CE:
      EPSILON: 0.1 # 0, 0.1
    TRI:
      HARD_MINING: True
      MARGIN: 0.3 # vehicle: 0.0
    NAME: ("CrossEntropyLoss","TripletLoss",) # "CrossEntropyLoss", "TripletLoss","CircleLoss"

DATASETS:
  NAMES: ("DG_CUHK02", "DG_CUHK03_detected", "DG_Market1501", "DG_DukeMTMC", "DG_CUHK_SYSU",)
  # "DG_CUHK02", "DG_CUHK03_detected", "DG_Market1501", "DG_DukeMTMC", "DG_CUHK_SYSU", "DG_CUHK03_labeled"
  TESTS: ("ALL_GRID", "ALL_VIPER_only_10", "ALL_PRID") # DG_VIPeR, Market1501, ALL_VIPER_only_5, ALL_VIPER_5, ALL_PRID, PRID, GRID

DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 3
  NAIVE_WAY: True # True-> random, False-> same domain
  DELETE_REM: True # when false -> more images
  INDIVIDUAL: False 

#  DIVIDE_SOURCE: False # use True when 'DG' and modify IMS_PER_BATCH to get smaller
#  DIVIDE_METHOD: 'dataloader' # dataloader -> multiple dataloaders, sample -> single dataloaders

SOLVER:
  AMP: True
  OPT: "SGD" # SGD
  BASE_LR: 0.01 # 0.01
  ETA_MIN_LR: 7.7e-5

  MAX_ITER: 100 # vehicle: 100
  STEPS: [40, 70] # vehicle: [40, 70]

  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10

  CHECKPOINT_PERIOD: 30
  IMS_PER_BATCH: 80 # per each domain
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WRITE_PERIOD: 50
  MOMENTUM: 0.9

TEST:
  EVAL_PERIOD: 10
  IMS_PER_BATCH: 128
  REPORT_ALL: True
